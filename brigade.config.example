# Brigade Configuration
# Copy this to your project's brigade/ directory and customize
#
# NOTE: This file is OPTIONAL. Brigade works out of the box with just Claude CLI.
# Use this file to customize workers, enable OpenCode for cost savings, etc.

# ═══════════════════════════════════════════════════════════════════════════════
# QUICK START - COST OPTIMIZATION
# ═══════════════════════════════════════════════════════════════════════════════
# Two settings for cost savings with OpenCode:

USE_OPENCODE=false  # Set to true to use OpenCode for junior tasks

# Pick your OpenCode model (only used if USE_OPENCODE=true):
# Run `opencode models` to see all available models
OPENCODE_MODEL="zai-coding-plan/glm-4.7"  # Default: GLM 4.7 (fast, cheap)

# Other model options - just change the line above:
#   zai-coding-plan/glm-4.7                   - GLM 4.7 (default, fast)
#   opencode/glm-4.7-free                     - GLM 4.7 free tier
#   anthropic/claude-3-5-sonnet-latest        - Claude Sonnet via OpenCode
#   anthropic/claude-sonnet-4-5               - Claude Sonnet 4.5 via OpenCode

# ═══════════════════════════════════════════════════════════════════════════════
# WORKERS (Advanced - most people don't need to change these)
# ═══════════════════════════════════════════════════════════════════════════════
# Brigade supports multiple AI coding agents. Configure based on what you have.
#
# Supported agents:
#   claude      - Anthropic Claude (via claude CLI) - DEFAULT
#   opencode    - OpenCode (via opencode CLI) - recommended for junior tasks
#   codex       - OpenAI Codex (coming soon)
#   gemini      - Google Gemini (coming soon)
#   aider       - Aider (coming soon)
#   cursor      - Cursor (coming soon)
#   local       - Local models via Ollama (coming soon)
#
# DEFAULT: All workers use Claude. This works if you only have claude CLI installed.
# For cost savings, configure OpenCode for Line Cook (junior tasks).
#
# ═══════════════════════════════════════════════════════════════════════════════

# Executive Chef (director) - analyzes tasks, reviews work
# Recommended: Claude Opus for best reasoning
EXECUTIVE_CMD="claude --model opus"
EXECUTIVE_AGENT="claude"

# Sous Chef (senior) - complex tasks, architecture, integration
# Recommended: Claude Sonnet for balance of capability and cost
SOUS_CMD="claude --model sonnet"
SOUS_AGENT="claude"

# Line Cook (junior) - routine tasks, boilerplate, simple tests
# Default: Claude Sonnet (works out of the box)
# For cost savings: Set USE_OPENCODE=true above (recommended) or customize here
LINE_CMD="claude --model sonnet"
LINE_AGENT="claude"

# ═══════════════════════════════════════════════════════════════════════════════
# OPENCODE SETTINGS (Advanced)
# ═══════════════════════════════════════════════════════════════════════════════

# IMPORTANT: OpenCode must be configured to auto-approve permissions.
# Add this to ~/.config/opencode/opencode.json:
#   {
#     "permission": "allow"
#   }
# Without this, OpenCode will prompt for approval and hang in non-interactive mode.

# Optional: OpenCode server for faster cold starts
# OPENCODE_SERVER="http://localhost:4096"

# Claude settings
CLAUDE_DANGEROUSLY_SKIP_PERMISSIONS=true  # Auto-approve in non-interactive mode

# Codex settings (coming soon)
# CODEX_API_KEY=""
# CODEX_MODEL="code-davinci-002"

# Gemini settings (coming soon)
# GEMINI_API_KEY=""
# GEMINI_MODEL="gemini-pro"

# Aider settings (coming soon)
# AIDER_MODEL="gpt-4"

# Local/Ollama settings (coming soon)
# OLLAMA_MODEL="codellama"
# OLLAMA_HOST="http://localhost:11434"

# ═══════════════════════════════════════════════════════════════════════════════
# TESTING
# ═══════════════════════════════════════════════════════════════════════════════

# Command to run after each task to verify completion
# Leave empty to skip testing
TEST_CMD=""

# Examples:
# TEST_CMD="go test ./..."
# TEST_CMD="npm test"
# TEST_CMD="pytest"
# TEST_CMD="cargo test"

# ═══════════════════════════════════════════════════════════════════════════════
# ESCALATION
# ═══════════════════════════════════════════════════════════════════════════════

# Enable automatic escalation (Line Cook → Sous Chef after failures)
ESCALATION_ENABLED=true

# Number of iterations before escalating Line Cook → Sous Chef
ESCALATION_AFTER=3

# Enable Sous Chef → Executive Chef escalation (rare, for truly stuck tasks)
ESCALATION_TO_EXEC=true

# Number of iterations before escalating Sous Chef → Executive Chef
ESCALATION_TO_EXEC_AFTER=5

# ═══════════════════════════════════════════════════════════════════════════════
# EXECUTIVE REVIEW
# ═══════════════════════════════════════════════════════════════════════════════

# Enable Executive Chef review after task completion
REVIEW_ENABLED=true

# Only review tasks completed by junior workers (saves Opus calls)
REVIEW_JUNIOR_ONLY=true

# ═══════════════════════════════════════════════════════════════════════════════
# PHASE REVIEW (Optional - for larger projects)
# ═══════════════════════════════════════════════════════════════════════════════

# Enable periodic phase reviews where Executive Chef checks overall progress
# Useful for larger PRDs (10+ tasks) to catch drift from spec early
PHASE_REVIEW_ENABLED=false

# Review every N completed tasks (e.g., 5 = review after task 5, 10, 15...)
PHASE_REVIEW_AFTER=5

# ═══════════════════════════════════════════════════════════════════════════════
# CONTEXT ISOLATION
# ═══════════════════════════════════════════════════════════════════════════════

# Enable context isolation (fresh sessions per task)
CONTEXT_ISOLATION=true

# State file for session persistence (relative to PRD directory)
STATE_FILE="brigade-state.json"

# ═══════════════════════════════════════════════════════════════════════════════
# KNOWLEDGE SHARING
# ═══════════════════════════════════════════════════════════════════════════════

# Enable knowledge sharing between workers
KNOWLEDGE_SHARING=true

# Learnings file (relative to PRD directory)
LEARNINGS_FILE="brigade-learnings.md"

# ═══════════════════════════════════════════════════════════════════════════════
# PARALLEL EXECUTION
# ═══════════════════════════════════════════════════════════════════════════════

# Maximum parallel workers (0 = sequential)
MAX_PARALLEL=3

# ═══════════════════════════════════════════════════════════════════════════════
# LIMITS
# ═══════════════════════════════════════════════════════════════════════════════

# Maximum iterations per task before giving up
MAX_ITERATIONS=50
